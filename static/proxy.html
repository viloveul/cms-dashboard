<!DOCTYPE html>
<html>
    <head>
        <title>Proxy API</title>
        <meta content="noindex, nofollow" name="robots">
    </head>
    <body>
        <script type="text/javascript">
            "use strict";

			window.addEventListener("message", function (event) {
				var url = window.localStorage.getItem('general:url') || '/';
				var brand = window.localStorage.getItem('general:brand') || 'Viloveul';

				if (typeof event.data === 'object') {
					if (url === event.origin) {
						for (var z in event.data) {
							if (typeof event.data[z] === 'string') {
								window.localStorage.setItem('features:' + z, event.data[z]);
							} else {
								window.localStorage.setItem('features:' + z, JSON.stringify(event.data[z]));
							}
						}
						event.source.postMessage('ok', event.origin);
					} else {
						event.source.postMessage('e', event.origin);
					}
				} else {
					var matched = url === event.origin;
					var ok = confirm('allow ' + event.origin + ' for execute ' + event.data + ' ?');
					if (matched === true || ok === true) {
						if (event.data.indexOf('viloveul.get:') === 0) {
							event.source.postMessage(window.localStorage.getItem(event.data.substr(13)), event.origin);
						} else if (event.data.indexOf('viloveul.unset:') === 0) {
							window.localStorage.removeItem(event.data.substr(15));
							event.source.postMessage('ok', event.origin);
						} else {
							event.source.postMessage('e', event.origin);
						}
					} else {
						event.source.postMessage('e', event.origin);
					}
				}
			});

			window.addEventListener("storage", function (event) {
				if (event.key === 'vtoken' && event.newValue === null) {
					alert("You was logged out from dashboard.");
				}
			});
        </script>
    </body>
</html>
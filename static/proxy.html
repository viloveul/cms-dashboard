<!DOCTYPE html>
<html>
    <head>
        <title>Proxy API</title>
        <meta content="noindex, nofollow" name="robots">
    </head>
    <body>
        <script type="text/javascript">
            "use strict";
			var handler = function (event) {
				var url = window.localStorage.getItem('general:url') || '/';
				var brand = window.localStorage.getItem('general:brand') || 'Viloveul';
				try {
					var parsed = JSON.parse(event.data);
					if (url === event.origin) {
						for (var a in parsed) {
							window.localStorage.setItem('features:' + a, JSON.stringify(parsed[a]))
						}
					}
					event.source.postMessage('ok', event.origin);
				} catch (e) {
					if (event.data.indexOf('viloveul.get:') === 0) {
						var k = event.data.substr(13);
						if (url === event.origin || confirm('allow ' + event.origin + ' for access ' + k + '?')) {
							event.source.postMessage(window.localStorage.getItem(k), event.origin);
						} else {
							event.source.postMessage('e', event.origin);
						}
					} else if (event.data.indexOf('viloveul.unset:') === 0) {
						var k = event.data.substr(15);
						if (url === event.origin || confirm('allow ' + event.origin + ' for delete ' + k + '?')) {
							window.localStorage.removeItem(k)
						}
						event.source.postMessage('ok', event.origin);
					} else {
						event.source.postMessage('e', event.origin);
					}
				}
			};
			window.addEventListener("message", handler, true);
        </script>
    </body>
</html>